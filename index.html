<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HOA Light Bulb Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-page: #f4f4f4;
      --bg-card: #ffffff;
      --border: #000000;
      --text-main: #111111;

      /* highlight colors when selected */
      --front-color: #ffe082;  /* yellow-ish */
      --bowl-color:  #90caf9;  /* light blue */
      --flood-color: #ffab91;  /* peach/orange */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 1rem;
    }

    body.editing .light {
      cursor: pointer;
    }

    body:not(.editing) .light {
      cursor: default;
    }

    .app {
      max-width: 1200px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    header.app-header {
      background: #000;
      color: #fff;
      border-radius: 10px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    header .title {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    header .subtitle {
      font-size: 0.85rem;
      opacity: 0.85;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .mode-badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      border-radius: 999px;
      padding: 0.2rem 0.7rem;
      border: 1px solid #fff;
      background: rgba(255,255,255,0.1);
    }

    .header-btn {
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
    }

    .header-btn[disabled] {
      opacity: 0.4;
      cursor: default;
    }

main.layout {
  display: block;
  margin-top: 1rem;
}

    #buildings {
    display: grid;
    gap: 0.75rem;
    grid-template-columns: repeat(3, minmax(0, 1fr)); /* 3 columns on wider screens */
    }

    .summary {
    background: var(--bg-card);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 0.75rem 0.9rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    max-width: 260px;       /* keep it visually narrower */
    justify-self: end;      /* hug the right side of its column */
    }

    .summary h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .summary-empty {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    #selectionList {
      list-style: none;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 0.25rem;
      font-size: 0.85rem;
    }

    #selectionList li + li {
      margin-top: 0.2rem;
    }

    .actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .actions button {
      flex: 1;
      min-width: 120px;
      padding: 0.45rem 0.6rem;
      border-radius: 999px;
      border: 2px solid var(--border);
      background: #fff;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
    }

    .actions button:hover {
      background: #eee;
    }

    .actions button:active {
      transform: translateY(1px);
    }

    /* Building cards */

    .building-card {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 0.6rem 0.7rem 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .building-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .building-title {
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-size: 0.85rem;
    }

    .building-meta {
      font-size: 0.75rem;
      opacity: 0.75;
    }

    .level {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .level-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .level-label span {
      border-bottom: 1px solid var(--border);
      flex: 1;
    }

    .level-label span.text {
      border-bottom: none;
      flex: 0;
      margin-right: 0.4rem;
    }

    .unit-grid {
      display: grid;
      /* auto-fit prevents overflow, all units stay inside the card */
      grid-template-columns: repeat(auto-fit, minmax(48px, 1fr));
      gap: 0.3rem;
      margin-bottom: 0.25rem;
    }

    .back-row {
      border-top: 2px solid var(--border);
      padding-top: 0.25rem;
      margin-top: 0.25rem;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0.2rem;
    }

    /* Light buttons */

    .light {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.15rem;
      padding: 0.35rem 0.2rem;
      border: none;
      background: transparent;
      font-size: 0.7rem;
      color: var(--text-main);
      text-align: center;
    }

    .light:focus-visible {
      outline: 2px solid var(--border);
      outline-offset: 2px;
    }

    .light-shape {
      width: 22px;
      height: 22px;
      border-radius: 4px;
      border: 2px solid var(--border);
      background: #fff;
      transition: background-color 0.15s ease, transform 0.15s ease;
    }

    .light-text {
      line-height: 1.2;
      white-space: normal;
      font-size: 0.75rem;
      text-align: center;
    }

    .light.is-selected .light-shape {
      transform: scale(1.06);
    }

    .light[data-kind="front"].is-selected .light-shape {
      background: var(--front-color);
    }

    .light[data-kind="bowl"].is-selected .light-shape {
      background: var(--bowl-color);
    }

    .light[data-kind="flood"].is-selected .light-shape {
      background: var(--flood-color);
    }

    /* Responsive tweaks */

    @media (max-width: 960px) {
    #buildings {
        grid-template-columns: repeat(2, minmax(0, 1fr)); /* 2 columns on medium screens */
    }
    }

    @media (max-width: 600px) {
    #buildings {
        grid-template-columns: 1fr; /* 1 column on small phones */
    }
    }


    @media print {
      body {
        padding: 0;
        background: #fff;
      }
      header.app-header,
      .actions {
        display: none !important;
      }
      .summary {
        border: none;
      }

      /* 2-column building layout for print */
      #buildings {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 0.5rem;
      }

      .light-shape {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .light[data-kind="front"].is-selected .light-shape {
        background-color: var(--front-color) !important;
      }
      .light[data-kind="bowl"].is-selected .light-shape {
        background-color: var(--bowl-color) !important;
      }
      .light[data-kind="flood"].is-selected .light-shape {
        background-color: var(--flood-color) !important;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <div class="title">HOA Light Bulb Picker</div>
        <div class="subtitle">Tap lights that need changing, then print the list for maintenance.</div>
      </div>
      <div class="header-controls">
        <span id="modeLabel" class="mode-badge">View Only</span>
        <button id="adminBtn" type="button" class="header-btn">Admin</button>
        <button id="saveEditBtn" type="button" class="header-btn" disabled>Save</button>
      </div>
    </header>

    <main class="layout">
      <section id="buildings" aria-label="Buildings"></section>

      <aside class="summary" aria-label="Selected Lights">
        <h2>Selected Lights</h2>
        <p class="summary-empty">No lights selected yet. Tap any light (in admin edit mode) to mark it.</p>
        <ul id="selectionList"></ul>
        <div class="actions">
          <button id="clearBtn" type="button">Clear All</button>
          <button id="printBtn" type="button">Print</button>
        </div>
      </aside>
    </main>
  </div>

  <script>
    // ---- CONFIG ----
    const BUILDING_COUNT = 5;
    const UNITS_PER_BUILDING = 12;
    const UNITS_PER_LEVEL = 6; // 6 upstairs, 6 downstairs
    const ADMIN_USERNAME = 'lightChecker';
    const STORAGE_KEY = 'hoaLightState_v1';

    const buildingsContainer = document.getElementById('buildings');
    const selectionList = document.getElementById('selectionList');
    const summaryEmptyEl = document.querySelector('.summary-empty');
    const modeLabel = document.getElementById('modeLabel');
    const adminBtn = document.getElementById('adminBtn');
    const saveEditBtn = document.getElementById('saveEditBtn');
    const summaryPanel = document.querySelector('.summary');

    let isEditing = false;

    function setMode(editing) {
      isEditing = editing;
      document.body.classList.toggle('editing', editing);

      if (editing) {
        modeLabel.textContent = 'Editing';
        saveEditBtn.disabled = false;
      } else {
        modeLabel.textContent = 'View Only';
        saveEditBtn.disabled = true;
      }
    }

    function createLight({ building, unit = null, kind, position = null }) {
      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'light';

      button.dataset.building = String(building);
      button.dataset.kind = kind; // 'front' | 'bowl' | 'flood'
      if (unit !== null) button.dataset.unit = String(unit);
      if (position !== null) button.dataset.position = String(position);

      // Short label shown in the box
      let labelText;
      if (kind === 'front') {
        labelText = `U${unit}<br>Front`;
      } else if (kind === 'bowl') {
        labelText = `Bowl ${position}`;
      } else { // flood
        labelText = `Flood ${position}`;
      }

      button.innerHTML = `
        <span class="light-shape" aria-hidden="true"></span>
        <span class="light-text">${labelText}</span>
      `;

      button.title = describeLight(button); // tooltip

      button.addEventListener('click', () => {
        if (!isEditing) return;        // locked unless in edit mode
        button.classList.toggle('is-selected');
        updateSelectionList();
      });

      return button;
    }

    function describeLight(el) {
      const b = el.dataset.building;
      const kind = el.dataset.kind;
      const unit = el.dataset.unit;
      const pos = el.dataset.position;

      if (kind === 'front') {
        return `Building ${b}, Unit ${unit} – Front Yellow`;
      } else if (kind === 'bowl') {
        return `Building ${b} – Back Bowl ${pos}`;
      } else if (kind === 'flood') {
        return `Building ${b} – Back Flood ${pos}`;
      }
      return '';
    }

    function updateSelectionList() {
      selectionList.innerHTML = '';

      const selected = Array.from(
        document.querySelectorAll('.light.is-selected')
      );

      if (!selected.length) {
        summaryEmptyEl.style.display = 'block';
        return;
      }

      summaryEmptyEl.style.display = 'none';

      const kindOrder = { front: 0, bowl: 1, flood: 2 };

      selected
        .sort((a, b) => {
          const ba = parseInt(a.dataset.building, 10);
          const bb = parseInt(b.dataset.building, 10);
          if (ba !== bb) return ba - bb;

          const ka = kindOrder[a.dataset.kind] ?? 99;
          const kb = kindOrder[b.dataset.kind] ?? 99;
          if (ka !== kb) return ka - kb;

          const ua = parseInt(a.dataset.unit || a.dataset.position || '0', 10);
          const ub = parseInt(b.dataset.unit || b.dataset.position || '0', 10);
          return ua - ub;
        })
        .forEach(el => {
          const li = document.createElement('li');
          li.textContent = describeLight(el);
          selectionList.appendChild(li);
        });
    }

    function buildUI() {
      for (let b = 1; b <= BUILDING_COUNT; b++) {
        const card = document.createElement('article');
        card.className = 'building-card';

        const header = document.createElement('div');
        header.className = 'building-header';
        header.innerHTML = `
          <div class="building-title">Building ${b}</div>
          <div class="building-meta">Units 1–12 · Back: 2 Bowls, 2 Floods</div>
        `;
        card.appendChild(header);

        // Upstairs / Downstairs
        ['Upstairs', 'Downstairs'].forEach((levelName, levelIndex) => {
          const level = document.createElement('div');
          level.className = 'level';

          const label = document.createElement('div');
          label.className = 'level-label';
          label.innerHTML = `
            <span class="text">${levelName}</span>
            <span></span>
          `;
          level.appendChild(label);

          const unitGrid = document.createElement('div');
          unitGrid.className = 'unit-grid';

          const startUnit =
            levelIndex === 0 ? 1 : UNITS_PER_LEVEL + 1; // 1–6 upstairs, 7–12 downstairs

          for (let i = 0; i < UNITS_PER_LEVEL; i++) {
            const unitNum = startUnit + i;
            const lightBtn = createLight({
              building: b,
              unit: unitNum,
              kind: 'front'
            });
            unitGrid.appendChild(lightBtn);
          }

          level.appendChild(unitGrid);
          card.appendChild(level);
        });

        // Back lights (2 bowls, 2 floods)
        const backRow = document.createElement('div');
        backRow.className = 'back-row';

        for (let bowlIndex = 1; bowlIndex <= 2; bowlIndex++) {
          backRow.appendChild(
            createLight({
              building: b,
              kind: 'bowl',
              position: bowlIndex
            })
          );
        }

        for (let floodIndex = 1; floodIndex <= 2; floodIndex++) {
          backRow.appendChild(
            createLight({
              building: b,
              kind: 'flood',
              position: floodIndex
            })
          );
        }

        card.appendChild(backRow);
        buildingsContainer.appendChild(card);
      }
    }

    // ---- State persistence (localStorage) ----

    function getStateFromDOM() {
      const selected = [];
      document.querySelectorAll('.light.is-selected').forEach(el => {
        selected.push({
          building: el.dataset.building,
          kind: el.dataset.kind,
          unit: el.dataset.unit ?? null,
          position: el.dataset.position ?? null
        });
      });
      return { selected };
    }

    function applyState(state) {
      document
        .querySelectorAll('.light.is-selected')
        .forEach(el => el.classList.remove('is-selected'));

      if (!state || !Array.isArray(state.selected)) {
        updateSelectionList();
        return;
      }

      state.selected.forEach(s => {
        let selector = `.light[data-building="${s.building}"][data-kind="${s.kind}"]`;
        if (s.unit !== null && s.unit !== undefined) {
          selector += `[data-unit="${s.unit}"]`;
        }
        if (s.position !== null && s.position !== undefined) {
          selector += `[data-position="${s.position}"]`;
        }
        const el = document.querySelector(selector);
        if (el) {
          el.classList.add('is-selected');
        }
      });

      updateSelectionList();
    }

    function saveState() {
      try {
        const state = getStateFromDOM();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error('Unable to save state', e);
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const state = JSON.parse(raw);
        applyState(state);
      } catch (e) {
        console.error('Unable to load state', e);
      }
    }

    // ---- Clear / Print buttons ----
    document.getElementById('clearBtn').addEventListener('click', () => {
      document
        .querySelectorAll('.light.is-selected')
        .forEach(el => el.classList.remove('is-selected'));
      updateSelectionList();
    });

    document.getElementById('printBtn').addEventListener('click', () => {
      window.print();
    });

    // ---- Admin / Edit controls ----
    adminBtn.addEventListener('click', () => {
      if (isEditing) return; // already in edit mode

      const input = prompt('Enter admin username to edit:');
      if (input === ADMIN_USERNAME) {
        setMode(true);
      } else if (input !== null) {
        alert('Incorrect username.');
      }
    });

    saveEditBtn.addEventListener('click', () => {
      if (!isEditing) return;
      saveState();
      setMode(false);
    });

    // ---- Init ----
    buildUI();
    // move the Selected Lights panel into the buildings grid as the 6th card
    buildingsContainer.appendChild(summaryPanel);

    loadState();
    setMode(false); // locked / view-only by default
  </script>
</body>
</html>
